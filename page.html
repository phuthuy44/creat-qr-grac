<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Admin ‚Äì T·∫°o QR</title>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background-image: url('https://png.pngtree.com/background/20210715/original/pngtree-plant-palm-leaf-simple-background-picture-image_1325702.jpg');
    background-size: cover;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.box {
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,.15);
    min-width: 320px;
}

input, button {
    width: auto;
    padding: 10px;
    margin-top: 10px;
}

button {
    background: #007bff;
    color: #fff;
    border: none;
    cursor: pointer;
    border-radius: 6px;
}

.hidden {
    display: none;
}

#qr-wrapper {
    position: relative;
    width: 180px;
    height: 180px;
    margin: 15px auto;
}

#qrcode img {
    width: 180px;
    height: 180px;
}

.qr-logo {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 42px;
    height: 42px;
    transform: translate(-50%, -50%);
    background: #fff;
    padding: 5px;
    border-radius: 10px;
}
</style>
</head>

<body>

<div class="box">

<!-- LOGIN -->
<div id="login">
    <h3>T·∫†O QR ‚Äì N·ªòI B·ªò</h3>
    <input id="user" placeholder="T√†i kho·∫£n">
    <input id="pass" type="password" placeholder="M·∫≠t kh·∫©u">
    <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">
    <h3>C·∫•u h√¨nh QR</h3>

    <!-- RADIO -->
    <label>
        <input type="radio" name="qrType" value="app" checked onchange="switchType()">
        QR t·∫£i App
    </label>
    <label style="margin-left:15px">
        <input type="radio" name="qrType" value="web" onchange="switchType()">
        QR Website
    </label>

    <!-- APP FORM -->
    <div id="appForm">
        <input id="android" placeholder="Link CH Play (Android)">
        <input id="ios" placeholder="Link App Store (iOS)">
    </div>

    <!-- WEB FORM -->
    <div id="webForm" class="hidden">
        <input id="webLink" placeholder="Link website (https://...)">
    </div>

    <button onclick="saveConfig()">T·∫°o QR</button>

    <!-- QR -->
    <div id="qr-wrapper" class="hidden">
        <div id="qrcode"></div>
        <img src="images (1).png" class="qr-logo">
    </div>

    <button id="btnDownload" class="hidden" onclick="downloadQR()">
        T·∫£i m√£ QR
    </button>
</div>

</div>

<script>
const loginDiv = document.getElementById("login");
const adminDiv = document.getElementById("admin");
const qrDiv = document.getElementById("qrcode");
const qrWrapper = document.getElementById("qr-wrapper");
const btnDownload = document.getElementById("btnDownload");

const STORAGE_KEY = "APP_QR_CONFIG";
const REDIRECT_LINK = "https://phuthuy44.github.io/creat-qr-grac/redirect.html";

/* LOGIN */
function login() {
    if (user.value === "admin" && pass.value === "123456") {
        loginDiv.classList.add("hidden");
        adminDiv.classList.remove("hidden");
    } else {
        alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u");
    }
}

/* SWITCH TYPE */
function switchType() {
    const type = document.querySelector('input[name="qrType"]:checked').value;

    // Hi·ªán / ·∫©n form
    appForm.classList.toggle("hidden", type !== "app");
    webForm.classList.toggle("hidden", type !== "web");

    // üî• RESET QR C≈®
    qrDiv.innerHTML = "";
    qrWrapper.classList.add("hidden");
    btnDownload.classList.add("hidden");
    localStorage.removeItem(STORAGE_KEY);
}

/* SAVE */
function saveConfig() {
    const type = document.querySelector('input[name="qrType"]:checked').value;
    let cfg = { type };

    if (type === "app") {
        if (!android.value || !ios.value) {
            alert("Nh·∫≠p ƒë·ªß link Android & iOS");
            return;
        }
        cfg.android = android.value.trim();
        cfg.ios = ios.value.trim();
    } else {
        if (!webLink.value) {
            alert("Nh·∫≠p link website");
            return;
        }

        // üî• B·∫ÆT BU·ªòC C√ì https
        let link = webLink.value.trim();
        if (!link.startsWith("http")) {
            link = "https://" + link;
        }

        cfg.web = link;
    }

    localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg));
    createQR();
}


/* CREATE QR */
function createQR() {
    const cfg = JSON.parse(localStorage.getItem(STORAGE_KEY));
    let qrLink = REDIRECT_LINK;

    if (cfg.type === "web") {
        qrLink += "?web=" + encodeURIComponent(cfg.web);
    } else {
        qrLink += "?android=" + encodeURIComponent(cfg.android)
               + "&ios=" + encodeURIComponent(cfg.ios);
    }

    qrDiv.innerHTML = "";

    new QRCode(qrDiv, {
        text: qrLink,
        width: 800,
        height: 800,
        correctLevel: QRCode.CorrectLevel.H
    });

    const img = qrDiv.querySelector("img");
    img.style.width = "180px";
    img.style.height = "180px";

    qrWrapper.classList.remove("hidden");
    btnDownload.classList.remove("hidden");
}

/* DOWNLOAD */
function downloadQR() {
    const qrImg = qrDiv.querySelector("img");
    const logo = document.querySelector(".qr-logo");
    const size = qrImg.naturalWidth;

    const canvas = document.createElement("canvas");
    canvas.width = size;
    canvas.height = size;
    const ctx = canvas.getContext("2d");

    const imgQR = new Image();
    imgQR.src = qrImg.src;

    imgQR.onload = () => {
        ctx.drawImage(imgQR, 0, 0);

        const imgLogo = new Image();
        imgLogo.src = logo.src;

        imgLogo.onload = () => {
            const logoSize = size * 0.18;
            const x = (size - logoSize) / 2;
            const y = (size - logoSize) / 2;

            ctx.fillStyle = "#fff";
            ctx.fillRect(x - 20, y - 20, logoSize + 40, logoSize + 40);
            ctx.drawImage(imgLogo, x, y, logoSize, logoSize);

            const a = document.createElement("a");
            a.href = canvas.toDataURL("image/png");
            a.download = "qr.png";
            a.click();
        };
    };
}
</script>

</body>
</html>
